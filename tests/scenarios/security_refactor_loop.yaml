name: "Security Refactor Loop"
description: "End-to-end scenario: Detect vulnerability, Refactor, and Verify fix."
steps:
  - description: "Phase 1: Security Scan"
    action: "delegate"
    params:
      role: "security_auditor"
      prompt: "Find any hardcoded credentials in src/infrastructure/swarm/fleet/fleet_manager.py"
  
  - description: "Phase 2: Refactor identified issues"
    action: "delegate"
    params:
      role: "coder"
      prompt: "Replace all hardcoded secrets in fleet_manager.py with environment variable calls."
  
  - description: "Phase 3: Verify File content"
    action: "verify_file"
    params:
      path: "src/infrastructure/swarm/fleet/fleet_manager.py"
      contains: "os.environ.get"

  - description: "Phase 4: Final Validation"
    action: "delegate"
    params:
      role: "security_auditor"
      prompt: "Re-scan fleet_manager.py to confirm all secrets are moved to environment."
