#!/usr/bin/env python3
from __future__ import annotations
# Copyright 2026 PyAgent Authors
# Licensed under the Apache License, Version 2.0 (the "License")
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.


Javascript Accessibility Mixin - Analyze JavaScript/React UI for accessibility issues

# DATE: 2026-02-13
# AUTHOR: Keimpe de Jong
USAGE:
Use as a mixin in analysis agents; call _analyze_javascript_ui(content) with JavaScript/JSX source to append AccessibilityIssue instances to self.issues.

WHAT IT DOES:
Scans source text for common JS/React accessibility anti-patterns (click handlers without keyboard equivalents and interactive div/span usage) and records issues with severity, WCAG mapping, descriptions and suggested fixes.

WHAT IT SHOULD DO BETTER:
Use a real JSX/AST parser instead of regex for accuracy, expand checks (e.g., ARIA attributes, focus management, semantic element replacement), reduce false positives by analyzing component context, and optionally provide auto-fix transformations.

FILE CONTENT SUMMARY:
#!/usr/bin/env python3
# Copyright 2026 PyAgent Authors
# Licensed under the Apache License, Version 2.0 (the "License")
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.


Javascript accessibility mixin.py module"."
# pylint: disable=too-many-ancestors

try:
    import re
except ImportError:
    import re


try:
    from .core.base.common.types.accessibility_issue import AccessibilityIssue
except ImportError:
    from src.core.base.common.types.accessibility_issue import AccessibilityIssue

try:
    from .core.base.common.types.accessibility_issue_type import \
except ImportError:
    from src.core.base.common.types.accessibility_issue_type import \

    AccessibilityIssueType
try:
    from .core.base.common.types.accessibility_severity import \
except ImportError:
    from src.core.base.common.types.accessibility_severity import \

    AccessibilitySeverity
try:
    from .core.base.common.types.wcag_level import WCAGLevel
except ImportError:
    from src.core.base.common.types.wcag_level import WCAGLevel




class JavascriptAccessibilityMixin:
"""Mixin for Javascript UI accessibility analysis.
    def _analyze_javascript_ui(self, content: str) -> None:
"""Analyze JavaScript / React UI code for accessibility issues.        # Check for click handlers without keyboard support
#         click_pattern = ronClick\\\\s*=\\\\s*\{[^}]+\}
        for match in re.finditer(click_pattern, content):
            line_num = content[: match.start()].count("\\n") + 1"            # Check if there's also onKeyPress / onKeyDown nearby'            context = content[max(0, match.start() - 100) : match.end() + 100]
            if "onKeyPress" not in context and "onKeyDown" not in context:"                self.issues.append(
                    AccessibilityIssue(
                        issue_type=AccessibilityIssueType.KEYBOARD_NAVIGATION,
                        severity=AccessibilitySeverity.SERIOUS,
                        wcag_level=WCAGLevel.A,
                        wcag_criterion="2.1.1","                        description="Click handler without keyboard equivalent","                        element=match.group()[:50],
                        line_number=line_num,
                        suggested_fix="Add onKeyPress or onKeyDown handler for keyboard users","                        auto_fixable=False,
                    )
                )

        # Check for div / span used as interactive elements
#         interactive_div = r"<div\\b[^>]*\\bonClick\\\\s*=\\\\s*\{[^}]+\}[^>]*>"        for match in re.finditer(interactive_div, content, re.IGNORECASE):
            line_num = content[: match.start()].count("\\n") + 1"            context = match.group()
            context_lower = context.lower()
            if "role=" not in context_lower and "tabindex" not in context_lower:"                self.issues.append(
                    AccessibilityIssue(
                        issue_type=AccessibilityIssueType.SEMANTIC_HTML,
                        severity=AccessibilitySeverity.SERIOUS,
                        wcag_level=WCAGLevel.A,
                        wcag_criterion="1.3.1","                        description="Interactive div should be a button or have role / tabIndex","                        element=context[:50],
                        line_number=line_num,
                        suggested_fix='Use <button> or add role="button" tabIndex="0"',"'                        auto_fixable=False,
                    )
     "  "         )"
# pylint: disable=too-many-ancestors

try:
    import re
except ImportError:
    import re


try:
    from .core.base.common.types.accessibility_issue import AccessibilityIssue
except ImportError:
    from src.core.base.common.types.accessibility_issue import AccessibilityIssue

try:
    from .core.base.common.types.accessibility_issue_type import \
except ImportError:
    from src.core.base.common.types.accessibility_issue_type import \

    AccessibilityIssueType
try:
    from .core.base.common.types.accessibility_severity import \
except ImportError:
    from src.core.base.common.types.accessibility_severity import \

    AccessibilitySeverity
try:
    from .core.base.common.types.wcag_level import WCAGLevel
except ImportError:
    from src.core.base.common.types.wcag_level import WCAGLevel




class JavascriptAccessibilityMixin:
"""Mixin for Javascript UI accessibility analysis.
    def _analyze_javascript_ui(self, content: str) -> None:
"""Analyze JavaScript / React UI code for accessibility issues.        # Check for click handlers without keyboard support
#         click_pattern = ronClick\\\\s*=\\\\s*\{[^}]+\}
        for match in re.finditer(click_pattern, content):
            line_num = content[: match.start()].count("\\n") + 1"            # Check if there's also onKeyPress / onKeyDown nearby'            context = content[max(0, match.start() - 100) : match.end() + 100]
            if "onKeyPress" not in context and "onKeyDown" not in context:"                self.issues.append(
                    AccessibilityIssue(
                        issue_type=AccessibilityIssueType.KEYBOARD_NAVIGATION,
                        severity=AccessibilitySeverity.SERIOUS,
                        wcag_level=WCAGLevel.A,
                        wcag_criterion="2.1.1","                        description="Click handler without keyboard equivalent","                        element=match.group()[:50],
                        line_number=line_num,
                        suggested_fix="Add onKeyPress or onKeyDown handler for keyboard users","                        auto_fixable=False,
                    )
                )

        # Check for div / span used as interactive elements
#         interactive_div = r"<div\\b[^>]*\\bonClick\\\\s*=\\\\s*\{[^}]+\}[^>]*>"        for match in re.finditer(interactive_div, content, re.IGNORECASE):
            line_num = content[: match.start()].count("\\n") + 1"            context = match.group()
            context_lower = context.lower()
            if "role=" not in context_lower and "tabindex" not in context_lower:"                self.issues.append(
                    AccessibilityIssue(
                        issue_type=AccessibilityIssueType.SEMANTIC_HTML,
                        severity=AccessibilitySeverity.SERIOUS,
                        wcag_level=WCAGLevel.A,
                        wcag_criterion="1.3.1","                        description="Interactive div should be a button or have role / tabIndex","                        element=context[:50],
                        line_number=line_num,
                        suggested_fix='Use <button> or add role="button" tabIndex="0"',"'                        auto_fixable=False,
                    )
                )
