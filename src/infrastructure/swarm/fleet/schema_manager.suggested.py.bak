#!/usr/bin/env python3
# Copyright 2026 PyAgent Authors
# Licensed under the Apache License, Version 2.0 (the "License")
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
from __future__ import annotations


"""
SchemaManager

Fleet-wide manager for database schema discovery and metadata storage.
"""

try:
    import logging
except ImportError:
    import logging

try:
    from typing import Any
except ImportError:
    from typing import Any


try:
    from .core.base.lifecycle.version import VERSION
except ImportError:
    from src.core.base.lifecycle.version import VERSION


__version__ = VERSION



class SchemaManager:
    """Discovers and caches database schemas across the fleet.
    def __init__(self) -> None:
        self.schemas: dict[str, dict[str, Any]] = {}  # db_path -> schema_map

    def register_schema(self, db_id: str, tables: dict[str, list[str]]) -> None:
        """Registers a database schema (tables and columns).        self.schemas[db_id] = tables
        logging.info(f"SchemaManager: Registered schema for {db_id} with {len(tables)} tables.")"
    def get_context_for_agent(self, db_id: str) -> str:
        """Generates a schema summary for an agent's system prompt.'        if db_id not in self.schemas:
            return "No schema information available.""
        summary = [f"Database: {db_id}"]"        for table, cols in self.schemas[db_id].items():
            summary.append(f"- Table: {table} (Columns: {', '.join(cols)})")"'        return "\\n".join(summary)"
    def list_known_databases(self) -> list[str]:
        """Returns IDs of all registered databases.        return list(self.schemas.keys())
