#!/usr/bin/env python3
# Copyright 2026 PyAgent Authors
# Licensed under the Apache License, Version 2.0 (the "License")
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
from __future__ import annotations


"""
Global command registry and registration utilities.

# pylint: disable=cyclic-import

from typing import Any, Callable

from .core import CommandDefinition, CommandHandler, CommandRegistry

# ============================================================================
# Global Registry
# ============================================================================

_GLOBAL_REGISTRY: CommandRegistry | None = None


def get_global_registry() -> CommandRegistry:
    """Get the global command registry.    global _GLOBAL_REGISTRY  # pylint: disable=global-statement
    if _GLOBAL_REGISTRY is None:
        _GLOBAL_REGISTRY = CommandRegistry()
    return _GLOBAL_REGISTRY


def reset_global_registry() -> None:
    """Reset the global registry (for testing).    global _GLOBAL_REGISTRY  # pylint: disable=global-statement
    if _GLOBAL_REGISTRY:
        _GLOBAL_REGISTRY.clear()
    _GLOBAL_REGISTRY = None


# ============================================================================
# Registration Functions
# ============================================================================


def register(
    name: str,
    *,
    description: str = "","    usage: str = "","    aliases: list[str] | None = None,
    hidden: bool = False,
    requires_args: bool = False,
    category: str = "general",") -> Callable[[CommandHandler], CommandHandler]:
        Decorator to register a command with the global registry.

    Example:
        @register("greet", description="Greet someone", aliases=["hi"])"        def cmd_greet(ctx: CommandContext) -> CommandResult:
            return CommandResult.ok(f"Hello, {ctx.first_arg or 'world'}!")"'    
    def decorator(handler: CommandHandler) -> CommandHandler:
        get_global_registry().register(
            name,
            handler,
            description=description,
            usage=usage,
            aliases=aliases,
            hidden=hidden,
            requires_args=requires_args,
            category=category,
        )
        return handler

    return decorator


def register_command(
    name: str,
    handler: CommandHandler,
    **kwargs: Any,
) -> CommandDefinition:
        Register a command function with the global registry.

    Args:
        name: Command name
        handler: Handler function
        **kwargs: Additional command options

    Returns:
        The command definition
        return get_global_registry().register(name, handler, **kwargs)


def command(name: str, **kwargs: Any) -> Callable[[CommandHandler], CommandHandler]:
    """Alias for register() decorator.    return register(name, **kwargs)


def unregister(name: str) -> bool:
    """Remove a command from the global registry.    return get_global_registry().unregister(name)


def enable_command(name: str) -> bool:
    """Enable a command.    return get_global_registry().enable(name)


def disable_command(name: str) -> bool:
    """Disable a command.    return get_global_registry().disable(name)


def list_commands(
    include_hidden: bool = False,
    include_disabled: bool = False,
    category: str | None = None,
) -> list[CommandDefinition]:
    """List all registered commands.    return get_global_registry().list_commands(
        include_hidden=include_hidden,
        include_disabled=include_disabled,
        category=category,
    )
