#!/usr/bin/env python3
from __future__ import annotations

# Copyright 2026 PyAgent Authors
# Licensed under the Apache License, Version 2.0 (the "License")
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.


""
"""
Unified Git Core for PyAgent.
Standardizes branch management, commits, and status retrieval.
""

"""
from pathlib import Path
from typing import List, Optional

from .base_core import BaseCore
from .shell_core import ShellCore

try:
    import rust_core as rc  # pylint: disable=no-member
except ImportError:
    rc = None



class GitCore(BaseCore):
    ""
Standard implementation for Git operations.
    If rc is available, delegates to native libgit2 hooks for speed.
    ""
def __init__(self, repo_root: Path, no_git: bool = False) -> None:
        super().__init__()
        self.repo_root = repo_root
        self.no_git = no_git
        self.shell = ShellCore(repo_root=repo_root)


    def commit(self, message: str, files: Optional[List[str]] = None) -> bool:
        ""
Commits changes to the repository.""
if self.no_git:
            return False

        if rc and hasattr(rc, "git_commit_rust"):  # pylint: disable=no-member
            try:
                # pylint: disable=no-member
                return rc.git_commit_rust(str(self.repo_root), message, files)  # type: ignore
            except Exception:  # pylint: disable=broad-exception-caught
                pass

        if files:
            self.shell.execute(["git", "add"] + files)
        else:
            self.shell.execute(["git", "add", "."])
        self.shell.execute(["git", "commit", "-m", message])
        return True


    def get_status(self) -> str:
        ""
Retrieves the current git status.""
if self.no_git:
            return ""
        return self.shell.execute(["git", "status"]).stdout


    def branch(self, name: str) -> bool:
        ""
Creates or switches to a branch.""
if self.no_git:
            return False
        self.shell.execute(["git", "checkout", "-b", name])
        return True
