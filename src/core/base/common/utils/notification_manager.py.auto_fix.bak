"""Parser-safe NotificationManager stub.

Minimal, importable implementation used while repairing codebase.
Avoids external side effects and optional heavy dependencies.
"""

from __future__ import annotations

from typing import Any, Callable, Dict, List, Optional
import logging


class NotificationManager:
    """Minimal notification manager used by tests and imports.

    This stub records registered webhooks/callbacks and exposes a no-op
    `notify` method that calls callbacks synchronously.
    """

    def __init__(self, workspace_root: Optional[str] = None, recorder: Optional[Any] = None) -> None:
        self.webhooks: List[str] = []
        self.callbacks: List[Callable[[str, Dict[str, Any]], None]] = []
        self.workspace_root = workspace_root
        self.recorder = recorder

    def register_webhook(self, url: str) -> None:
        self.webhooks.append(url)

    def register_callback(self, cb: Callable[[str, Dict[str, Any]], None]) -> None:
        self.callbacks.append(cb)

    def notify(self, event_name: str, event_data: Dict[str, Any]) -> None:
        for cb in list(self.callbacks):
            try:
                cb(event_name, event_data)
            except Exception:
                logging.exception("Notification callback failed")


__all__ = ["NotificationManager"]