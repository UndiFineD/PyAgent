# PyAgent Workspace Context
# Generated: January 19, 2026
# Version: 3.15.0 (Evolution Phase 47 - SPECULATIVE DECODING V3 & KV OFFLOAD)

## Project Overview
PyAgent is an AI-powered multi-agent orchestration system for autonomous code improvement.
The fleet coordinates 50+ specialized agents across 5 architectural tiers to analyze,
improve, and maintain Python codebases with high autonomy.

## Architecture (5-Tiered)
- src/core/          → Primitives, Knowledge Trinity (B-Tree, Vector, Graph)
- src/logic/         → Swarm Intelligence, Specialized Agents, Reasoning Strategies  
- src/infrastructure/→ Fleet Management, Economy, API Wrappers, Orchestration, Engine
- src/interface/     → Multi-UI layer (CLI, GUI, Web, Mobile)
- src/observability/ → Telemetry, Stats, Reporting, Audit Trails

## Rust Acceleration (rust_core/)
- **513 PyO3 functions** for CPU-bound operations
- **Hardware-Aware Neural Engine** (`neural.rs`): Scales Transformer models based on VRAM/RAM.
- Integration: `rust_core.pyd` binary active in .venv site-packages.
- Recent fixes: Old rust_core.pyd in workspace root was blocking new module.
- Performance: 41% end-to-end acceleration; optimized complexity analysis (Rust-native).
- **Phase 14**: Cognitive acceleration (hedge word detection, top-K activations, buffer sorting).
- **Phase 15**: Core infrastructure (token estimation, graph cycle detection, structure analysis).
- **Phase 16**: Vector math & aggregation (embedding stats, k-means, similarity matrix, JSON compression).
- **Phase 17**: vLLM-inspired utilities (cdiv, power-of-2, xxhash, cache hit ratio, atomic counters).
- **Phases 18-33**: Resilience, performance, infrastructure, multimodal, attention.
- **Phase 34**: Disaggregated inference & KV transfer (12 Rust functions).
- **Phase 35**: Async execution & cache management (12 Rust functions).
- **Phase 36**: CUDA graph & torch.compile integration (8 Rust functions).
- **Phase 37**: Weight loading, KV offload & EPLB (9 Rust functions).
- **Phase 38**: FusedMoE, Mamba SSM & MLA (11 Rust functions).
- **Phase 39**: Structured output, speculative v2 & tensorizer (12 Rust functions).
- **Phase 40**: Reasoning, multimodal cache, pooling, inputs, media IO (17 Rust functions).
- **Phase 41**: Tokenizer registry, model registry, LoRA, logprobs, tools, structured output (18 Rust functions).
- **Phase 42**: Platform interface, OpenAI API, prompt rendering, MCP tools (17 Rust functions).
- **Phase 43**: Engine core, KV cache coordination, request queue, parallel sampling (16 Rust functions).
- **Phase 44**: Advanced sampling, speculative decoding v2, encoder cache, KV metrics (12 Rust functions).
- **Phase 45**: Worker protocol, executor patterns, spec decode orchestration (16 Rust functions).
- **Phase 46**: Structured output constraints, JSON schema, guided decoding (17 Rust functions).
- **Phase 47**: EAGLE speculative decoding, ARC/LRU offload, BlockTable v2 (14 Rust functions).

## Current State (Phase 47 COMPLETE)
- Test baseline: 3,064+ tests with 100% collection health.
- vLLM Integration: 31 phases complete (17-47), 513 Rust functions, ~148 Python modules.
- Self-Healing: Active. ZMQ Transport Layer now supports graceful shutdown and Ctrl+C interrupts.
- **Phase 47 Modules** (6 Python, 14 Rust):
  - EagleProposer.py: EAGLE-style speculative decoding with tree attention
  - NgramProposer.py: N-gram based draft proposal with fuzzy matching
  - SpecDecodeMetadataV2.py: Enhanced verification metadata
  - ARCOffloadManager.py: ARC cache eviction with T1/T2/B1/B2 ghost lists
  - LRUOffloadManager.py: LRU cache eviction variants (weighted/tiered/prefetching)
  - BlockTableV2.py: Enhanced block table with sparse representation

## Current State (Phase 319)
- Test baseline: 1,305+ tests with 100% collection health.
- Self-Healing: Active. ZMQ Transport Layer now supports graceful shutdown and Ctrl+C interrupts.
- Reinforcement Learning: [DEPLOYED] Full RL framework with 7 production-ready modules:
  - MDP.py: ExperienceReplayBuffer, value iteration, policy extraction, priority replay
  - Environment.py: Gymnasium-compatible CodeImprovementEnvironment with multi-objective rewards
  - ActionSpace.py: Discrete/Box/MultiDiscrete/Dict spaces with cooldowns and eligibility
  - TransitionDynamics.py: Laplace smoothing, entropy-based uncertainty, trajectory sampling
  - RewardFunctions.py: RewardSignal/CompositeRewardFunction with curriculum learning and shaping
  - LearningObjectives.py: ObjectiveType enum, constraints, priority weighting, Pareto optimization
  - LearningAlgorithms.py: Q-Learning, SARSA, Double Q, TD(λ), UCB exploration, GAE
- Specialized Agents: [DEPLOYED] 20+ specialist agents with production-grade implementations:
  - MathAgent: Safe expression evaluation, calculus, matrix operations, equation solving
  - VisionAgent: OCR, code screenshot analysis, diagram interpretation, chart parsing
  - ReasoningAgent: 5 strategies (CoT, ToT, Self-Consistency, Reflection, Multi-Agent Debate)
  - TrustAgent: Multi-dimensional trust scoring, EmotionalState, manipulation detection
  - ScalingAgent: 5 load balancing strategies (Round-Robin, Weighted, Least-Conn, Random, IP-Hash)
  - StreamAgent: Webhook registration, retry logic, schema validation, event buffering
  - GUIAgent: 9 framework support, UI element caching, accessibility auditing (WCAG)
  - VotingAgent: 7 voting methods including ranked-choice, Borda, and quadratic voting
  - ClassificationAgent: 4 classification types with taxonomy registration and batch processing
  - DimensionalityAgent: PCA, random projection, k-means clustering with explained variance
  - RegressionAgent: Linear/polynomial/exponential regression, Mann-Kendall trend detection
  - WebSearchEssayAgent: 6 essay styles, multi-query research, fact-checking, citation
  - ObsidianCodeDescriberAgent: Directory documentation, YAML frontmatter, MOC generation
- Complexity Reduction: [VERIFIED] All 32 high-complexity targets resolved. Current max complexity < 25 project-wide.
- Model backend: Ollama/tinyllama:latest (Local High-Speed) -> Copilot CLI (Fallback).
- Stability Gate: 1.0 (Green).

## vLLM Integration Summary (Phases 17-47)
| Phase | Focus | Modules | Rust Fns |
|-------|-------|---------|----------|
| 17 | Core Patterns | 6 | 11 |
| 18 | Resilience | 6 | 0 |
| 19 | Performance | 6 | 0 |
| 20-24 | Infrastructure | 27 | 20 |
| 25-28 | Inference | 15 | 36 |
| 29-33 | Advanced | 20 | 50 |
| 34-36 | Async/CUDA | 18 | 32 |
| 37 | Weight/EPLB | 4 | 9 |
| 38 | MoE/SSM/MLA | 4 | 11 |
| 39 | Struct/Spec/Tens | 6 | 12 |
| 40 | Reasoning/Media | 6 | 17 |
| 41 | Token/Model/LoRA | 6 | 18 |
| 42 | Platform/API/Prompt | 6 | 17 |
| 43 | Engine/KVCache/Queue | 4 | 16 |
| 44 | Sampling/SpecDec v2 | 6 | 12 |
| 45 | Worker/Executor | 6 | 16 |
| 46 | Structured Output | 6 | 17 |
| 47 | EAGLE/KV Offload | 6 | 14 |
| **Total** | - | **~148** | **513** |

## Data & Observability
- 1,024 virtual shards for interaction history (Rust-native MD5 implementation verified).
- Shard 220: GitHub Copilot CLI deprecation patterns successfully ingested and verified.
- Centralized ConnectivityManager with 15-minute persistent TTL status cache.
- Structured Logger yielding valid, masked JSON logs via Rust core.

## Known Issues to Address (Phase 319 Focus)
- [RESOLVED] Swarm Intelligence: Implement ZeroMQ-mDNS bridge in DiscoveryNode for decentralized routing.
- [RESOLVED] Performance: Cycle overhead reduced with Phase 15 optimizations.
- [RESOLVED] Swarm Intelligence: Verified complexity reductions improved reasoning latency.
- [COMPLETED] Phase 15: AgentCore, SubagentRunner, AgentRegistryCore Rust acceleration.
- [COMPLETED] Phase 16: DimensionalityAgent, StorageEngine, RollupEngine, PromptManagers, SemanticSearchEngine, ABEngine.
- [COMPLETED] Phase 17: vLLM pattern integration - 6 Python modules, 11 Rust functions, 21/21 tests passed.
- [COMPLETED] Phase 38: FusedMoE, Mamba SSM & MLA - 4 Python modules, 11 Rust functions, 50/50 tests passed.
- [COMPLETED] Phase 39: Structured Output, Speculative v2 & Tensorizer - 6 Python modules, 12 Rust functions, 40/40 tests passed.
- [COMPLETED] Phase 40: Reasoning, MultiModal Cache, Pooling, Inputs, Media IO - 6 Python modules, 17 Rust functions, 35/35 tests passed.
- [NEW] Phase 41: Continue vLLM pattern integration (see docs/comparison_vllm.md for remaining patterns).

