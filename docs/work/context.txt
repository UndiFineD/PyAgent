# PyAgent Fleet Self-Improvement Context
# Last Updated: 2026-01-14
# Purpose: Strategic directives for autonomous fleet improvement cycles

## MISSION
Transform PyAgent from a high-performing autonomous multi-agent system into a 
production-grade, performant, secure platform through:
1. Strategic Rust integration for computational cores (10-50x performance gains)
2. Systematic code quality hardening (security, reliability, maintainability)
3. Autonomous self-improvement capabilities (scaling across 989 files)

## CODEBASE SNAPSHOT
- **Size**: 989 Python files, ~500K LOC
- **Architecture**: Core/Shell separation (pure logic vs I/O)
- **Agents**: 100+ specialized agents across diverse domains
- **Quality**: 99.6% Ruff compliance
- **Type Coverage**: ~70% (all public APIs required)
- **Test Coverage**: ~85% unit test coverage

## PHASE 1: RUST CONVERSION STRATEGY (COMPLETED - 275% ✅)
**Goal**: Convert 20 Tier-1 Core files for immediate performance gains.
**Status**: 55 Files Optimized (See docs/work/RUST_Ready.md)

### Completed Conversions (Selection)
- **LoggingCore.py** (PII Masking)
- **SearchMeshCore** (Search aggregation)
- **CoderCore** (Style Checking)
- **ToolDraftingCore** (Name Validation)
- **WebCore** (HTML Cleaning)
- **CodeQualityCore** (Analysis)
- **BashCore** (Linting Helper)
- **AndroidCore** (ADB Helper)

## PHASE 2: SECURITY HARDENING (COMPLETED ✅)
**Goal**: Eliminate critical vulnerabilities and harden file operations.
- Completed: exec(), shell=True, os.popen() vulnerabilities fixed.
- Logging: All print() statements removed from src/ (0 remaining).

## PHASE 3: DEEP OPTIMIZATION & TIER 3 (COMPLETED ✅)
**Goal**: Deep optimization of Tier 2 and Tier 3 agents using Rust.
- **CodeQualityCore.py**: Fully optimized logic.
- **BashCore.py**: Safety flags injected via Rust.
- **AndroidCore.py**: Device parsing via Rust.
- **CurationCore.py**: Verified existing optimization.

## PHASE 4: HYGIENE & SAFETY VERIFICATION (COMPLETED ✅)
**Goal**: Ensure strict compliance and safety for migrated components.
- **Strict Types**: Verified for all migrated cores.
- **Documentation**: 100% Docstring coverage for migrated cores.
- **Safety**: 0 Runtime print statements verified (migrated cores).
- **Testing**: Metrics engine imports fixed, hygiene tests passed.

## PHASE 5: RESIDUAL SAFETY & HYGIENE (COMPLETED ✅)
**Goal**: Eliminate residual print statements found in deep scan.
- **Result**: `src/core/knowledge/vector_store.py` fixed (logging).
- **Audit**: `ConfigHotReloader` and `SystemAnalytics` confirmed safe (docstrings).
- **Status**: 0 Runtime prints in production source.


## PHASE 6: ARCHITECTURE & DOCS (COMPLETED ✅)
**Goal**: Enforce Core/Shell separation and documentation standards.
- **Refactoring**: `BaseAgent.py` logic moved to `BaseAgentCore.py`.
- **Docs**: 10 Critical classes documented (Fleet/Orchestration).
- **Status**: Undocumented count reduced from 62 to 52.

## PHASE 7: CRITICAL LOGIC DOCUMENTATION (COMPLETED ✅)
**Goal**: Comprehensive documentation for Tier 2/3 Logic Cores.
- **Cognitive**: `EvolutionCore`, `QuantumCore` fully documented.
- **Simulation**: `HopperSim`, `SimulationCore` fully documented.
- **Dev/Sec**: `AndroidCore`, `BashCore`, `PrivacyCore`, `ToolDraftingCore`.
- **Status**: Undocumented count reduced from 52 to 40.

## FLEET SCRIPT CAPABILITIES
**Location**: src/infrastructure/dev/scripts/run_fleet_self_improvement.py

### Dual Directive System

# Single directive
python run_fleet_self_improvement.py -p docs/work/prompt.txt

# Dual directives (merged)
python run_fleet_self_improvement.py -p docs/work/prompt.txt -t docs/work/context.txt


### Auto-Fix Capabilities
- Import organization (absolute/relative conversion)
- Syntax fixes (E401, E402, E701)
- Module docstring addition
- Simple refactoring patterns

### Manual Review Categories
- Architectural changes (Core/Shell splits)
- Security fixes
- Complex logic changes
- Rust integration

## ARCHITECTURAL CONSTRAINTS
1. **Core/Shell Pattern is Mandatory**
   - Core: Pure logic, deterministic, Rust-convertible
   - Shell: I/O, orchestration, side effects
   - Files >20KB must follow this pattern

2. **Type Safety First**
   - All public functions: Return type hints required
   - All parameters: Type hints required
   - Union types: Use | syntax (Python 3.10+)
   - None checking: Explicit handling

3. **Atomic Operations**
   - File writes: Create temp → validate → atomic rename
   - Multi-step operations: Rollback on error
   - Configuration: Copy-on-write semantics

4. **Context Recording**
   - Use LocalContextRecorder for AI-driven decisions
